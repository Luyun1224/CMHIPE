<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全人照護跨領域教學討論滿意度自評表</title>
    <!-- Include Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Use Noto Sans TC for better Chinese character rendering */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        /* Custom styles for radio buttons to ensure they are consistently sized */
        input[type="radio"] {
            width: 1.25rem;
            height: 1.25rem;
        }
        /* Style for table headers */
        th {
            text-align: center;
            vertical-align: middle;
            padding: 0.75rem 0.5rem;
            border: 1px solid #e5e7eb; /* gray-200 */
        }
        /* Style for table cells */
        td {
            text-align: center;
            vertical-align: middle;
            padding: 0.75rem 0.5rem;
            border: 1px solid #e5e7eb; /* gray-200 */
        }
        /* Left-align the first column of the table */
        td:first-child {
            text-align: left;
        }
        /* Style for the save status message */
        #saveStatus {
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-lg p-6 sm:p-8">

            <!-- Back Button -->
            <div class="mb-6">
                <button id="backButton" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg class="w-5 h-5 mr-2 -ml-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    返回
                </button>
            </div>

            <!-- Header Section -->
            <header class="text-center mb-8 border-b pb-4">
                <h1 class="text-xl sm:text-2xl font-bold text-gray-800">奇美醫療財團法人奇美醫院</h1>
                <h2 class="text-lg sm:text-xl font-semibold text-blue-700 mt-2">全人照護跨領域教學討論滿意度自評表</h2>
            </header>

            <!-- Form starts here -->
            <form id="satisfactionForm">

                <!-- Section 1: Basic Information -->
                <fieldset class="mb-8">
                    <legend class="text-xl font-semibold text-gray-700 mb-4 border-l-4 border-blue-600 pl-3">一、基本資料</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                        <div class="border border-gray-200 rounded-lg p-3">
                            <label for="name" class="block text-sm font-medium text-gray-600">姓名</label>
                            <input type="text" id="name" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" required>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-3">
                            <label for="date" class="block text-sm font-medium text-gray-600">會議日期</label>
                            <input type="date" id="date" name="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" required>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-3">
                            <label for="unit" class="block text-sm font-medium text-gray-600">單位</label>
                            <input type="text" id="unit" name="unit" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" required>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-3">
                            <label for="rank" class="block text-sm font-medium text-gray-600">職級</label>
                            <input type="text" id="rank" name="rank" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" required>
                        </div>
                    </div>
                </fieldset>

                <!-- Section 2: Before Training Assessment -->
                <fieldset class="mb-8">
                    <legend class="text-xl font-semibold text-gray-700 mb-4 border-l-4 border-blue-600 pl-3">二、滿意度評估 (訓練前)</legend>
                    <p class="text-sm text-gray-500 mb-4">請在對應的方格內勾選最符合您看法的選項。</p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse border border-gray-200 bg-white">
                            <thead class="bg-blue-50">
                                <tr>
                                    <th class="w-1/3">評核項目</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">非常同意 (5)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">同意 (4)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">普通 (3)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">不同意 (2)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">非常不同意 (1)</th>
                                </tr>
                            </thead>
                            <tbody id="before-training-body" class="text-sm text-gray-700">
                                <!-- Dynamically generated rows for "before" assessment -->
                            </tbody>
                        </table>
                    </div>
                </fieldset>
                
                <!-- Section 3: After Training Assessment -->
                <fieldset>
                    <legend class="text-xl font-semibold text-gray-700 mb-4 border-l-4 border-green-600 pl-3">三、滿意度評估 (訓練後)</legend>
                    <p class="text-sm text-gray-500 mb-4">請在對應的方格內勾選最符合您看法的選項。</p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border-collapse border border-gray-200 bg-white">
                            <thead class="bg-green-50">
                                <tr>
                                    <th class="w-1/3">評核項目</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">非常同意 (5)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">同意 (4)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">普通 (3)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">不同意 (2)</th>
                                    <th class="w-[13.3%] text-sm font-medium text-gray-600">非常不同意 (1)</th>
                                </tr>
                            </thead>
                            <tbody id="after-training-body" class="text-sm text-gray-700">
                                <!-- Dynamically generated rows for "after" assessment -->
                            </tbody>
                        </table>
                    </div>
                </fieldset>

                <!-- Section 4: Suggestions -->
                <fieldset class="mt-8">
                     <legend class="text-xl font-semibold text-gray-700 mb-4 border-l-4 border-yellow-600 pl-3">四、建議事項</legend>
                    <textarea id="suggestions" name="suggestions" rows="5" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="請在此輸入您的寶貴建議..."></textarea>
                </fieldset>

                <!-- Action Buttons -->
                <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                    <button type="button" id="saveDraftButton" class="w-full sm:w-auto inline-flex justify-center py-3 px-8 border border-gray-300 shadow-sm text-base font-medium rounded-full text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        暫存草稿
                    </button>
                    <button type="submit" class="w-full sm:w-auto inline-flex justify-center py-3 px-8 border border-transparent shadow-sm text-base font-medium rounded-full text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        提交表單
                    </button>
                </div>
                 <!-- Save Status Message -->
                <div id="saveStatus" class="mt-4 text-center text-green-600 font-medium opacity-0">
                    草稿已儲存！
                </div>
            </form>

            <!-- Success Message Modal -->
            <div id="successMessage" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                    <div class="mt-3 text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">提交成功！</h3>
                        <div class="mt-2 px-7 py-3">
                            <p class="text-sm text-gray-500">
                                感謝您的填寫，表單已成功提交。
                            </p>
                            <p class="text-xs text-gray-400 mt-2">此視窗將在 2 秒後自動關閉。</p>
                        </div>
                        <div class="items-center px-4 py-3">
                            <button id="closeModal" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300">
                                立即關閉
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DOM Element References ---
            const form = document.getElementById('satisfactionForm');
            const backButton = document.getElementById('backButton');
            const saveDraftButton = document.getElementById('saveDraftButton');
            const saveStatus = document.getElementById('saveStatus');
            const tableBodyBefore = document.getElementById('before-training-body');
            const tableBodyAfter = document.getElementById('after-training-body');
            const dateInput = document.getElementById('date');
            const successMessage = document.getElementById('successMessage');
            const closeModalButton = document.getElementById('closeModal');
            
            // --- Data and Constants ---
            const storageKey = 'satisfactionFormDraft';
            const questions = [
                '我很清楚各單位在臨床照護上的工作內容及特性',
                '我可以在臨床照護上和各單位做到良好的溝通',
                '我知道什麼時候應該傳達訊息給其他共同照護單位成員以尋求協助',
                '我知道運用什麼管道傳達訊息給其他共同照護單位成員以尋求協助',
                '良好的跨領域照護可以提升病人的品質',
                '良好的跨領域照護教育可以提升自我的臨床能力',
                '良好的跨領域照護教育會改善自我的臨床態度',
                '我會編寫合適的跨領域照護學習教案',
                '整體滿意度'
            ];

            // --- Functions ---

            /**
             * Populates a table with assessment questions and radio buttons.
             * @param {HTMLElement} tableBody - The tbody element to populate.
             * @param {string} period - The assessment period ('before' or 'after').
             */
            function populateTable(tableBody, period) {
                questions.forEach((questionText, index) => {
                    const row = document.createElement('tr');
                    row.className = 'even:bg-gray-50';

                    const questionCell = document.createElement('td');
                    questionCell.textContent = questionText;
                    questionCell.className = 'text-left p-3 font-medium';
                    row.appendChild(questionCell);

                    for (let i = 5; i >= 1; i--) {
                        const cell = document.createElement('td');
                        const radioInput = document.createElement('input');
                        radioInput.type = 'radio';
                        radioInput.name = `q${index}-${period}`;
                        radioInput.value = i;
                        radioInput.className = 'mx-auto';
                        if (period === 'before') {
                             radioInput.required = true;
                        }
                        cell.appendChild(radioInput);
                        row.appendChild(cell);
                    }
                    tableBody.appendChild(row);
                });
            }

            /**
             * Saves the current form data to localStorage.
             */
            function saveDraft() {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                localStorage.setItem(storageKey, JSON.stringify(data));
                
                saveStatus.style.opacity = '1';
                setTimeout(() => {
                    saveStatus.style.opacity = '0';
                }, 2000);
            }

            /**
             * Loads form data from localStorage and populates the form.
             */
            function loadDraft() {
                const savedData = localStorage.getItem(storageKey);
                if (!savedData) return;

                const data = JSON.parse(savedData);
                for (const [key, value] of Object.entries(data)) {
                    const element = form.elements[key];
                    if (element) {
                        if (element.constructor.name === 'RadioNodeList') {
                            for (const radio of element) {
                                if (radio.value === value) {
                                    radio.checked = true;
                                    break;
                                }
                            }
                        } else {
                            element.value = value;
                        }
                    }
                }
            }
            
            /**
             * Clears the saved draft from localStorage.
             */
            function clearDraft() {
                 localStorage.removeItem(storageKey);
            }
            
            /**
             * Closes the current browser window/tab.
             */
            function closePage() {
                // Note: This may not work in all browsers due to security restrictions.
                // It typically only works for windows opened by script (window.open()).
                window.close();
            }

            // --- Event Listeners ---

            backButton.addEventListener('click', () => {
                window.history.back();
            });
            
            saveDraftButton.addEventListener('click', saveDraft);

            form.addEventListener('submit', function (event) {
                event.preventDefault(); 

                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                console.log('Form Data Submitted:', JSON.stringify(data, null, 2));

                clearDraft();
                successMessage.classList.remove('hidden');

                // Automatically close the page after 2 seconds
                setTimeout(closePage, 2000); 
            });
            
            // Close modal button also closes the page
            closeModalButton.addEventListener('click', closePage);

            // --- Initialisation ---
            
            if (!dateInput.value) {
                dateInput.valueAsDate = new Date();
            }

            populateTable(tableBodyBefore, 'before');
            populateTable(tableBodyAfter, 'after');

            loadDraft();
        });
    </script>
</body>
</html>
